<% form_for @delivery do |f| %>
  <%= f.error_messages %>
  <p>
    <%= f.label :delivery_date %><br />
    <%= f.calendar_date_select :delivery_date, :onclick => %(enableCalendar()), :year_range => (Time.now..3.years.from_now), :value => Time.now.strftime("%B %d, %Y %I:%m %p") %>
  </p>
  <p>
    <%= f.label :store_id %><br />
    <% if Store.count > 0 %>
      <%= f.collection_select :store_id, Store.all, :id, :display_name %>
      <%= link_to "Add a new store", new_store_path %>
    <% end %>
  </p>
  <% if Employee.drivers.size > 0 %>
  <p>
    <%= f.label :employee_id, "Driver" %><br />
    <%= f.collection_select :employee_id, Employee.drivers, :id, :fullname %>
  </p>
  <% end %>
  <br />
  
  <table style="width: 100%; ">
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Quantity</th>
      <th>Price</th>
      <th>&nbsp;</th>
    </tr>
    
      <% for line_item in @delivery.line_items %>
        <% fields_for "delivery[line_items][]", line_item, :index => nil do |builder| %>
        <tr>
          <td><strong><%= line_item.item.name %></strong></td>
          <td><strong><%= line_item.item.item_type %></strong></td>
          <td align="right"><%= builder.text_field :quantity, :value => line_item.quantity, :size => 5 %></td>
          <td align="right" style="text-align: right;">
            <%= builder.text_field :price, :value => line_item.item.price, :size => 10, :class => "price" %>
            <%= builder.hidden_field :item_id, :value => line_item.item.id %>
          </td>
          <td><%= link_to(icon("pencil-small"), edit_item_path(line_item.item))%></td>
        
        </tr>
        <% end %>
     <% end %>
  </table>
  <%= f.submit :save %>
  
<% end %>

<% content_for :sidebar do %>
  <%= delivery_action_link(@delivery, true) %>  
<% end %>

<%= observe_field :delivery_store_id, :url => { :controller => "stores", :action => "presets", :format => :js}, :with => 'id' %>


<div id="no_drivers_alert" style="display: none;">
  Please assign atleast one <%= link_to 'Employee', employees_path %> as a driver first. Then come back and create the delivery.
</div>
<a id="no_drivers_alert_link" href="#no_drivers_alert" rel="ibox&amp;width=200&amp;height=80">&nbsp;</a>

<script type="text/javascript" charset="utf-8">
  document.observe("dom:loaded", function() {
    $('no_drivers_alert_link').onclick();
  });
</script>